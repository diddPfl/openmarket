<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.javalab.board.repository.ItemRepository">

    <!-- 모든 아이템 조회 -->
    <select id="findAll" resultType="com.javalab.board.vo.Item">
        SELECT item_id AS itemId, category_id AS categoryId,
        item_name AS itemName, item_detail AS itemDetail
        FROM item
    </select>

    <!-- id로 상품 조회 -->
    <select id="findById" parameterType="long" resultMap="itemResultMap">
        SELECT i.item_id AS itemId, i.category_id AS categoryId, i.item_name AS itemName, i.regdate, i.item_sell_status AS sellStatus,
        i.item_detail AS itemDetail, i.price,
        im.uuid AS uuid, im.file_name AS fileName, im.item_id AS imageItemId, c.category_name AS categoryName
        FROM item i
        LEFT JOIN item_image im ON i.item_id = im.item_id
        LEFT JOIN category c ON i.category_id = c.category_id
        WHERE i.item_id = #{itemId}
        ORDER BY i.item_id
    </select>

    <!-- 아이템에 대한 결과 매핑 -->
    <resultMap id="itemResultMap" type="com.javalab.board.vo.Item">
        <id property="itemId" column="itemId"/>
        <result property="categoryId" column="categoryId"/>
        <result property="categoryName" column="categoryName"/>
        <result property="itemName" column="itemName"/>
        <result property="regdate" column="regdate" />
        <result property="itemDetail" column="itemDetail"/>
        <result property="price" column="price"/>
        <collection property="images" ofType="com.javalab.board.vo.ItemImage">
            <id property="uuid" column="uuid"/>
            <result property="fileName" column="fileName"/>
            <result property="itemId" column="imageItemId"/>
        </collection>
    </resultMap>

</mapper>